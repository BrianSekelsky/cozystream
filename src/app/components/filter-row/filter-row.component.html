@if (items.length > 0) {
  <div style="margin-bottom: var(--row-spacing)">
    <!-- Heading -->
    <div class="relative inline-flex items-center gap-1.5 mb-3">
      <h2 class="text-base font-semibold text-white">{{ collection.name }}</h2>
      <button (click)="openEditor()" title="Edit filter"
        class="text-white/25 hover:text-white/70 transition-colors mt-px">
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
      </button>

      <!-- Inline filter editor -->
      @if (showEditor()) {
        <div class="absolute left-0 top-7 z-30 bg-surface-raised border border-white/10 rounded-xl p-4 shadow-2xl w-72">
          <p class="text-xs font-semibold text-white/50 uppercase tracking-wider mb-3">Edit row</p>

          <div class="mb-3">
            <label class="text-xs text-white/50 mb-1 block">Label</label>
            <input [(ngModel)]="editorLabel" (keydown.enter)="saveEditor()"
              class="w-full bg-surface-overlay text-white text-sm border border-white/10 rounded-lg px-3 py-1.5 focus:outline-none focus:border-white/30" />
          </div>

          <div class="mb-3">
            <label class="text-xs text-white/50 mb-1 block">Filter by</label>
            <div class="flex gap-1">
              @for (t of ['genre', 'director', 'decade']; track t) {
                <button (click)="setEditorFilterType(t)"
                  [class]="'flex-1 py-1.5 text-xs rounded-lg capitalize transition-colors ' + (editorFilterType === t ? 'bg-accent text-white' : 'bg-surface-overlay text-white/60 hover:text-white')">
                  {{ t }}
                </button>
              }
            </div>
          </div>

          <div class="mb-4">
            <label class="text-xs text-white/50 mb-1 block">Value</label>
            @if (editorFilterType === 'decade') {
              <select [(ngModel)]="editorFilterValue"
                class="w-full bg-surface-overlay text-white text-sm border border-white/10 rounded-lg px-3 py-1.5 focus:outline-none">
                <option value="">Select a decade</option>
                @for (d of decades; track d) {
                  <option [value]="d">{{ d }}s</option>
                }
              </select>
            } @else {
              <input [(ngModel)]="editorFilterValue"
                [placeholder]="editorFilterType === 'genre' ? 'e.g. Horror' : 'e.g. Christopher Nolan'"
                class="w-full bg-surface-overlay text-white text-sm border border-white/10 rounded-lg px-3 py-1.5 focus:outline-none focus:border-white/30 placeholder-white/30" />
            }
          </div>

          <div class="flex justify-end gap-2">
            <button (click)="showEditor.set(false)"
              class="px-3 py-1.5 text-xs text-white/50 hover:text-white transition-colors">
              Cancel
            </button>
            <button (click)="saveEditor()" [disabled]="!editorLabel.trim() || !editorFilterValue.trim()"
              class="px-3 py-1.5 text-xs bg-accent hover:bg-accent-hover text-white rounded-lg transition-colors disabled:opacity-40">
              Save
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Carousel -->
    <div class="relative">
      @if (canScrollLeft()) {
        <div class="absolute left-0 top-0 bottom-0 w-16 z-10 pointer-events-none"
          style="background: linear-gradient(to right, var(--color-surface), transparent)"></div>
        <button (click)="scroll('left')"
          class="absolute top-1/2 -translate-y-1/2 z-20 flex items-center justify-center w-8 h-8 rounded-full bg-surface-raised/90 border border-white/10 text-white shadow-lg hover:bg-surface-overlay transition-colors"
          style="left: -1rem">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
      }

      <div #scrollEl class="flex overflow-x-auto pt-8 -mt-8 pb-8 -mb-7 scrollbar-hide" style="gap: var(--card-gap)">
        @for (item of items; track item.id) {
          <div class="flex-shrink-0" style="width: var(--card-width)">
            <app-media-card [item]="item" />
          </div>
        }
      </div>

      @if (canScrollRight()) {
        <div class="absolute right-0 top-0 bottom-0 w-16 z-10 pointer-events-none"
          style="background: linear-gradient(to left, var(--color-surface), transparent)"></div>
        <button (click)="scroll('right')"
          class="absolute top-1/2 -translate-y-1/2 z-20 flex items-center justify-center w-8 h-8 rounded-full bg-surface-raised/90 border border-white/10 text-white shadow-lg hover:bg-surface-overlay transition-colors"
          style="right: -1rem">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      }
    </div>
  </div>
}
